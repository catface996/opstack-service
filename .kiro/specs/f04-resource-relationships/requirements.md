# 需求文档

## 简介

本文档规定了 AIOps Service 平台中建立和管理 IT 资源之间关系的需求。该功能使运维工程师能够创建、查看、编辑和删除资源之间的关系(如应用依赖数据库、服务调用关系),以便了解系统依赖结构,支持影响分析和故障定位。

## 术语表

- **资源(Resource)**: 系统中管理的 IT 资产,如服务器、应用、数据库或 API
- **关系(Relationship)**: 两个资源之间的有向或双向连接,描述它们的交互或依赖关系
- **源节点(Source Node)**: 关系中的起始资源(From)
- **目标节点(Target Node)**: 关系中的目标资源(To)
- **关系类型(Relationship Type)**: 资源之间连接的类别(依赖、调用、部署、归属、关联)
- **关系方向(Relationship Direction)**: 关系是单向还是双向
- **关系强度(Relationship Strength)**: 依赖的关键程度(强依赖、弱依赖)
- **上游依赖(Upstream Dependency)**: 当前资源所依赖的资源
- **下游依赖(Downstream Dependency)**: 依赖当前资源的资源
- **所有者(Owner)**: 对资源拥有完全控制权限的用户
- **查看者(Viewer)**: 对资源拥有只读权限的用户
- **系统(System)**: AIOps Service 平台

## 需求

### 需求 1

**用户故事:** 作为运维工程师,我希望能够创建资源之间的关系,以便记录和可视化系统依赖关系。

#### 验收标准

1. WHEN 用户选择源节点和目标节点 THEN 系统 SHALL 允许用户在它们之间创建关系
2. WHEN 用户创建关系 THEN 系统 SHALL 验证用户是否有权限访问源节点和目标节点
3. WHEN 用户创建关系 THEN 系统 SHALL 支持至少五种关系类型:依赖、调用、部署、归属和关联
4. WHEN 用户创建关系 THEN 系统 SHALL 允许用户指定关系方向为单向或双向
5. WHEN 用户创建关系 THEN 系统 SHALL 允许用户指定关系强度为强依赖或弱依赖
6. WHEN 用户创建关系 THEN 系统 SHALL 允许用户为关系添加描述

### 需求 2

**用户故事:** 作为运维工程师,我希望能够查看系统中的所有关系,以便了解整体依赖结构。

#### 验收标准

1. WHEN 用户请求关系列表 THEN 系统 SHALL 显示用户有权限查看的所有关系
2. WHEN 用户按源节点筛选 THEN 系统 SHALL 仅显示从该节点发起的关系
3. WHEN 用户按目标节点筛选 THEN 系统 SHALL 仅显示指向该节点的关系
4. WHEN 用户按关系类型筛选 THEN 系统 SHALL 仅显示该类型的关系
5. WHEN 用户按关系状态筛选 THEN 系统 SHALL 仅显示该状态的关系(正常或异常)

### 需求 3

**用户故事:** 作为运维工程师,我希望能够查看特定资源的所有关系,以便了解其依赖和被依赖情况。

#### 验收标准

1. WHEN 用户查看资源的关系 THEN 系统 SHALL 显示该资源的所有上游依赖
2. WHEN 用户查看资源的关系 THEN 系统 SHALL 显示该资源的所有下游依赖
3. WHEN 用户查看资源的关系 THEN 系统 SHALL 按类型分组显示关系
4. WHEN 用户查看资源的关系 THEN 系统 SHALL 显示每个关系的方向和强度

### 需求 4

**用户故事:** 作为运维工程师,我希望能够编辑关系属性,以便保持关系信息的准确性和时效性。

#### 验收标准

1. WHEN 用户是源节点或目标节点的所有者 THEN 系统 SHALL 允许用户编辑该关系
2. WHEN 用户不是源节点和目标节点的所有者 THEN 系统 SHALL 禁止用户编辑该关系
3. WHEN 用户编辑关系 THEN 系统 SHALL 允许修改关系类型
4. WHEN 用户编辑关系 THEN 系统 SHALL 允许修改关系强度
5. WHEN 用户编辑关系 THEN 系统 SHALL 允许修改关系状态
6. WHEN 用户编辑关系 THEN 系统 SHALL 允许修改关系描述

### 需求 5

**用户故事:** 作为运维工程师,我希望能够删除不再有效的关系,以便系统反映当前的依赖状态。

#### 验收标准

1. WHEN 用户是源节点或目标节点的所有者 THEN 系统 SHALL 允许用户删除该关系
2. WHEN 用户不是源节点和目标节点的所有者 THEN 系统 SHALL 禁止用户删除该关系
3. WHEN 用户删除关系 THEN 系统 SHALL 在执行删除前要求确认
4. WHEN 用户删除关系 THEN 系统 SHALL 立即从系统中移除该关系

### 需求 6

**用户故事:** 作为系统管理员,我希望系统能够维护关系的数据一致性,以便关系数据保持有效和可靠。

#### 验收标准

1. WHEN 用户创建关系 THEN 系统 SHALL 验证源节点和目标节点是否存在
2. WHEN 用户创建已存在的关系 THEN 系统 SHALL 拒绝创建并通知用户该关系已存在
3. WHEN 资源被删除 THEN 系统 SHALL 自动删除与该资源关联的所有关系
4. WHEN 用户创建双向关系 THEN 系统 SHALL 在两个方向都创建关系记录
5. WHEN 关系被创建或修改 THEN 系统 SHALL 记录操作的时间戳

### 需求 7

**用户故事:** 作为运维工程师,我希望系统能够快速响应关系查询,以便高效地分析依赖关系。

#### 验收标准

1. WHEN 用户查询关系 THEN 系统 SHALL 在 500 毫秒内返回结果
2. WHEN 系统包含多达 50000 条关系 THEN 系统 SHALL 在指定响应时间内保持查询性能
3. WHEN 用户执行图遍历查询 THEN 系统 SHALL 高效执行遍历而不超时
