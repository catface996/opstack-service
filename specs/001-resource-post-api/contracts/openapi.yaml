openapi: 3.0.3
info:
  title: 资源管理 API (POST 统一接口)
  description: |
    AIOps Service 资源管理模块 API 文档。

    本版本将所有接口统一改为 POST 方式，采用动词后缀 URL 路径。
  version: 2.0.0
  contact:
    name: AIOps Team

servers:
  - url: http://localhost:8080
    description: 本地开发环境

tags:
  - name: 资源管理
    description: IT资源管理接口：创建、查询、更新、删除、状态管理、审计日志

paths:
  /api/v1/resources/create:
    post:
      tags:
        - 资源管理
      summary: 创建资源
      description: 创建新的IT资源，敏感配置将自动加密存储
      operationId: createResource
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateResourceRequest'
      responses:
        '201':
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResourceResponse'
        '400':
          description: 参数无效
        '401':
          description: 未认证
        '409':
          description: 资源名称已存在

  /api/v1/resources/list:
    post:
      tags:
        - 资源管理
      summary: 查询资源列表
      description: 分页查询资源列表，支持按类型、状态、关键词过滤
      operationId: listResources
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListResourcesRequest'
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResourceResponse'
        '401':
          description: 未认证

  /api/v1/resources/detail:
    post:
      tags:
        - 资源管理
      summary: 查询资源详情
      description: 根据ID查询资源详细信息
      operationId: getResourceById
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetResourceRequest'
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResourceResponse'
        '401':
          description: 未认证
        '404':
          description: 资源不存在

  /api/v1/resources/update:
    post:
      tags:
        - 资源管理
      summary: 更新资源
      description: 更新资源信息，需要Owner或Admin权限
      operationId: updateResource
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateResourceRequest'
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResourceResponse'
        '400':
          description: 参数无效
        '401':
          description: 未认证
        '403':
          description: 无权限
        '404':
          description: 资源不存在
        '409':
          description: 版本冲突

  /api/v1/resources/delete:
    post:
      tags:
        - 资源管理
      summary: 删除资源
      description: 删除资源，需要输入资源名称确认
      operationId: deleteResource
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteResourceRequest'
      responses:
        '200':
          description: 删除成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoidResponse'
        '400':
          description: 资源名称确认不匹配
        '401':
          description: 未认证
        '403':
          description: 无权限
        '404':
          description: 资源不存在

  /api/v1/resources/update-status:
    post:
      tags:
        - 资源管理
      summary: 更新资源状态
      description: 更新资源状态（RUNNING/STOPPED/MAINTENANCE/OFFLINE）
      operationId: updateResourceStatus
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateResourceStatusRequest'
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResourceResponse'
        '400':
          description: 无效的状态值
        '401':
          description: 未认证
        '404':
          description: 资源不存在
        '409':
          description: 版本冲突

  /api/v1/resources/audit-logs:
    post:
      tags:
        - 资源管理
      summary: 查询审计日志
      description: 查询资源的操作审计日志
      operationId: getResourceAuditLogs
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetResourceAuditLogsRequest'
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageAuditLogResponse'
        '401':
          description: 未认证
        '404':
          description: 资源不存在

  /api/v1/resource-types/list:
    post:
      tags:
        - 资源管理
      summary: 查询资源类型列表
      description: 获取所有可用的资源类型
      operationId: getAllResourceTypes
      security:
        - bearerAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              description: 空对象或不传
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResourceTypeListResponse'
        '401':
          description: 未认证

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # 请求对象
    CreateResourceRequest:
      type: object
      required:
        - name
        - resourceTypeId
      properties:
        name:
          type: string
          maxLength: 100
          description: 资源名称
          example: web-server-01
        description:
          type: string
          maxLength: 500
          description: 资源描述
          example: 生产环境Web服务器
        resourceTypeId:
          type: integer
          format: int64
          description: 资源类型ID
          example: 1
        attributes:
          type: string
          description: 扩展属性（JSON格式）
          example: '{"ip": "192.168.1.100", "port": 8080}'

    ListResourcesRequest:
      type: object
      properties:
        resourceTypeId:
          type: integer
          format: int64
          description: 资源类型ID（可选）
        status:
          type: string
          enum: [RUNNING, STOPPED, MAINTENANCE, OFFLINE]
          description: 资源状态（可选）
        keyword:
          type: string
          description: 搜索关键词（可选）
        page:
          type: integer
          minimum: 1
          default: 1
          description: 页码
        size:
          type: integer
          minimum: 1
          maximum: 100
          default: 10
          description: 每页大小

    GetResourceRequest:
      type: object
      required:
        - id
      properties:
        id:
          type: integer
          format: int64
          description: 资源ID
          example: 1

    UpdateResourceRequest:
      type: object
      required:
        - id
        - version
      properties:
        id:
          type: integer
          format: int64
          description: 资源ID
          example: 1
        name:
          type: string
          maxLength: 100
          description: 资源名称（null表示不修改）
        description:
          type: string
          maxLength: 500
          description: 资源描述（null表示不修改）
        attributes:
          type: string
          description: 扩展属性（null表示不修改）
        version:
          type: integer
          description: 当前版本号（乐观锁）
          example: 1

    DeleteResourceRequest:
      type: object
      required:
        - id
        - confirmName
      properties:
        id:
          type: integer
          format: int64
          description: 资源ID
          example: 1
        confirmName:
          type: string
          description: 确认的资源名称
          example: web-server-01

    UpdateResourceStatusRequest:
      type: object
      required:
        - id
        - status
        - version
      properties:
        id:
          type: integer
          format: int64
          description: 资源ID
          example: 1
        status:
          type: string
          enum: [RUNNING, STOPPED, MAINTENANCE, OFFLINE]
          description: 新状态
        version:
          type: integer
          description: 当前版本号（乐观锁）
          example: 1

    GetResourceAuditLogsRequest:
      type: object
      required:
        - id
      properties:
        id:
          type: integer
          format: int64
          description: 资源ID
          example: 1
        page:
          type: integer
          minimum: 1
          default: 1
          description: 页码
        size:
          type: integer
          minimum: 1
          maximum: 100
          default: 10
          description: 每页大小

    # 响应对象
    ResourceResponse:
      type: object
      properties:
        code:
          type: integer
          example: 0
        message:
          type: string
          example: 操作成功
        data:
          $ref: '#/components/schemas/ResourceDTO'

    PageResourceResponse:
      type: object
      properties:
        code:
          type: integer
          example: 0
        message:
          type: string
          example: 操作成功
        data:
          $ref: '#/components/schemas/PageResult'

    VoidResponse:
      type: object
      properties:
        code:
          type: integer
          example: 0
        message:
          type: string
          example: 操作成功
        data:
          type: object
          nullable: true

    ResourceTypeListResponse:
      type: object
      properties:
        code:
          type: integer
          example: 0
        message:
          type: string
          example: 操作成功
        data:
          type: array
          items:
            $ref: '#/components/schemas/ResourceTypeDTO'

    PageAuditLogResponse:
      type: object
      properties:
        code:
          type: integer
          example: 0
        message:
          type: string
          example: 操作成功
        data:
          $ref: '#/components/schemas/PageResultAuditLog'

    # 数据传输对象
    ResourceDTO:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        resourceTypeId:
          type: integer
          format: int64
        resourceTypeName:
          type: string
        status:
          type: string
        attributes:
          type: string
        ownerId:
          type: integer
          format: int64
        ownerName:
          type: string
        version:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ResourceTypeDTO:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string

    PageResult:
      type: object
      properties:
        records:
          type: array
          items:
            $ref: '#/components/schemas/ResourceDTO'
        total:
          type: integer
          format: int64
        page:
          type: integer
        size:
          type: integer

    PageResultAuditLog:
      type: object
      properties:
        records:
          type: array
          items:
            $ref: '#/components/schemas/ResourceAuditLogDTO'
        total:
          type: integer
          format: int64
        page:
          type: integer
        size:
          type: integer

    ResourceAuditLogDTO:
      type: object
      properties:
        id:
          type: integer
          format: int64
        resourceId:
          type: integer
          format: int64
        operationType:
          type: string
        operatorId:
          type: integer
          format: int64
        operatorName:
          type: string
        oldValue:
          type: string
        newValue:
          type: string
        createdAt:
          type: string
          format: date-time
