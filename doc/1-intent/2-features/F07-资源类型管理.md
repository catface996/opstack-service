# F02-1: 资源类型管理

## 基本信息

- **Feature ID**: F02-1
- **Feature 名称**: 资源类型管理
- **优先级**: P1（增强功能）
- **状态**: 待分析
- **负责人**: 待分配
- **预计工作量**: 待评估
- **前置依赖**: F03（创建和管理IT资源）

## 背景说明

在 F03 需求分析过程中，识别出系统需要支持动态的资源类型管理能力，而非硬编码固定的6种资源类型。这将显著提升系统的可扩展性和灵活性。

## 决策记录

**决策时间**: 2024-11-30  
**决策内容**: 采用"架构前瞻，分阶段实现"策略
- **MVP阶段（F03）**: 使用预置的6种资源类型，但数据模型设计时预留扩展性
- **增强阶段（F02-1）**: 实现资源类型的动态管理功能

**决策理由**:
1. 降低MVP风险，先验证核心价值
2. 快速交付，MVP可在2-3周内完成
3. 架构合理，数据模型已考虑扩展性，无重构成本
4. 遵循敏捷原则，先交付核心价值，再迭代增强

## 用户故事（初步）

作为系统管理员，我希望能够自定义资源类型及其属性，以便系统能够适应不同组织的IT资源管理需求。

## 核心功能（初步）

### 1. 资源类型管理
- 创建自定义资源类型
- 编辑资源类型信息（名称、描述、图标）
- 删除资源类型（需检查是否有资源实例）
- 查看资源类型列表
- 区分系统预置类型和自定义类型

### 2. 资源类型属性管理
- 为资源类型定义自定义属性
- 配置属性类型（文本、数字、日期、枚举、布尔等）
- 设置属性约束（必填、唯一、正则验证等）
- 定义属性显示顺序
- 删除属性（需检查数据影响）

### 3. 属性验证规则
- 配置属性的验证规则
- 支持正则表达式验证
- 支持自定义验证逻辑
- 验证错误提示配置

## 技术考虑（初步）

### 数据模型设计（F03已预留）

```sql
-- 资源类型表
CREATE TABLE resource_type (
    id BIGINT PRIMARY KEY,
    code VARCHAR(50) UNIQUE NOT NULL,      -- 类型编码
    name VARCHAR(100) NOT NULL,            -- 类型名称
    description TEXT,                      -- 类型描述
    icon VARCHAR(100),                     -- 图标
    is_system BOOLEAN DEFAULT FALSE,       -- 是否系统预置
    attribute_schema JSON,                 -- 属性定义Schema
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    created_by BIGINT,
    INDEX idx_code (code),
    INDEX idx_is_system (is_system)
);

-- 资源类型属性定义表
CREATE TABLE resource_type_attribute (
    id BIGINT PRIMARY KEY,
    resource_type_id BIGINT NOT NULL,      -- 所属资源类型
    code VARCHAR(50) NOT NULL,             -- 属性编码
    name VARCHAR(100) NOT NULL,            -- 属性名称
    data_type VARCHAR(20) NOT NULL,        -- 数据类型：STRING, NUMBER, DATE, ENUM, BOOLEAN
    is_required BOOLEAN DEFAULT FALSE,     -- 是否必填
    is_unique BOOLEAN DEFAULT FALSE,       -- 是否唯一
    default_value TEXT,                    -- 默认值
    validation_rule JSON,                  -- 验证规则
    display_order INT,                     -- 显示顺序
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    FOREIGN KEY (resource_type_id) REFERENCES resource_type(id),
    UNIQUE KEY uk_type_code (resource_type_id, code),
    INDEX idx_type_id (resource_type_id)
);
```

### 扩展性考虑
- 属性Schema使用JSON存储，支持灵活扩展
- 验证规则支持插件化扩展
- 支持属性分组和Tab页展示

## 验收标准（初步）

### AC1: 创建资源类型
**WHEN** 管理员创建新的资源类型 **THEN** THE System **SHALL** 验证类型编码唯一性并保存

### AC2: 定义类型属性
**WHEN** 管理员为资源类型添加属性 **THEN** THE System **SHALL** 验证属性定义的合法性

### AC3: 删除保护
**WHEN** 管理员尝试删除有资源实例的类型 **THEN** THE System **SHALL** 禁止删除并提示

### AC4: 系统类型保护
**WHEN** 管理员尝试删除系统预置类型 **THEN** THE System **SHALL** 禁止删除

### AC5: 属性验证
**WHEN** 用户创建资源实例 **THEN** THE System **SHALL** 根据类型定义验证属性值

## 依赖关系

### 前置依赖
- F03: 创建和管理IT资源（必须先完成，数据模型已预留扩展性）
- F10: 用户登录和身份认证
- F11: 管理资源的访问权限

### 后置依赖
- 无（独立功能）

## 与F03的关系

### F03的实现约束
为了支持F02-1的未来实现，F03在实现时**必须**遵循以下约束：

1. **数据模型约束**：
   - 资源表必须通过 `resource_type_id` 关联资源类型，而非硬编码类型字段
   - 扩展属性必须使用JSON存储，而非固定字段
   - 必须创建 `resource_type` 表并预置6种类型

2. **代码设计约束**：
   - 资源类型相关逻辑必须通过配置驱动，而非硬编码
   - 属性验证逻辑必须支持动态规则
   - UI展示必须支持动态字段渲染

3. **测试约束**：
   - 必须测试通过 `resource_type` 表查询类型的场景
   - 必须测试JSON属性的存储和查询

## 风险和挑战

### 技术风险
- **风险1**: 动态属性验证的性能问题
  - 缓解策略：属性定义缓存、验证规则预编译

- **风险2**: JSON属性查询性能
  - 缓解策略：为常用属性建立虚拟列索引

### 业务风险
- **风险3**: 用户自定义类型过于复杂，难以维护
  - 缓解策略：提供类型模板、最佳实践指南

## 后续行动

- [ ] 待F03完成后，进行详细的需求分析
- [ ] 进行用户调研，了解自定义类型的真实需求
- [ ] 评估技术方案，特别是性能和安全性
- [ ] 制定详细的实施计划

## 相关文档

- 前置Feature: `doc/1-intent/2-features/F03-创建和管理IT资源.md`
- 需求分析记录: 待创建

---

**创建日期**: 2024-11-30  
**最后更新**: 2024-11-30  
**文档版本**: v1.0  
**状态**: 📋 待分析（F03完成后启动）
