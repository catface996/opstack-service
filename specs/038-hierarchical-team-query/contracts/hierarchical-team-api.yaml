openapi: 3.0.3
info:
  title: Hierarchical Team Query API
  description: API for querying hierarchical agent team structure by topology ID
  version: 1.0.0

servers:
  - url: http://localhost:8081/api/service/v1
    description: Local development server

paths:
  /topologies/hierarchical-team/query:
    post:
      tags:
        - Topology
      summary: Query hierarchical team structure by topology ID
      description: |
        Returns the hierarchical agent team structure for a given topology.
        The structure includes:
        - Global Supervisor: The agent bound to the topology as global supervisor
        - Teams: List of teams, each corresponding to a member node in the topology
          - Each team has a Team Supervisor (if any) and Team Workers
      operationId: queryHierarchicalTeam
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HierarchicalTeamQueryRequest'
            example:
              topologyId: 1
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HierarchicalTeamResponse'
              examples:
                fullTeam:
                  summary: Full hierarchical team
                  value:
                    code: 0
                    message: success
                    success: true
                    data:
                      topologyId: 1
                      topologyName: Production Environment
                      globalSupervisor:
                        id: 1
                        name: Global Coordinator
                        role: GLOBAL_SUPERVISOR
                        hierarchyLevel: GLOBAL_SUPERVISOR
                        specialty: System-wide coordination and escalation
                        model: claude-3-opus
                      teams:
                        - nodeId: 10
                          nodeName: Web Server
                          supervisor:
                            id: 2
                            name: Web Team Lead
                            role: SCOUTER
                            hierarchyLevel: TEAM_SUPERVISOR
                            specialty: Web application diagnostics
                            model: gemini-2.0-flash
                          workers:
                            - id: 3
                              name: Log Analyzer
                              role: WORKER
                              hierarchyLevel: TEAM_WORKER
                              specialty: Log analysis
                              model: gemini-2.0-flash
                            - id: 4
                              name: Performance Monitor
                              role: WORKER
                              hierarchyLevel: TEAM_WORKER
                              specialty: Performance monitoring
                              model: gemini-2.0-flash
                emptyTeam:
                  summary: Topology with no agents bound
                  value:
                    code: 0
                    message: success
                    success: true
                    data:
                      topologyId: 2
                      topologyName: Staging Environment
                      globalSupervisor: null
                      teams:
                        - nodeId: 20
                          nodeName: App Server
                          supervisor: null
                          workers: []
        '404':
          description: Topology not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: 404
                message: Topology not found
                success: false
                data: null

components:
  schemas:
    HierarchicalTeamQueryRequest:
      type: object
      required:
        - topologyId
      properties:
        topologyId:
          type: integer
          format: int64
          description: The ID of the topology to query
          example: 1
        tenantId:
          type: integer
          format: int64
          description: Tenant ID (injected by gateway)
          x-hidden: true
        traceId:
          type: string
          description: Trace ID (injected by gateway)
          x-hidden: true
        userId:
          type: integer
          format: int64
          description: User ID (injected by gateway)
          x-hidden: true

    HierarchicalTeamResponse:
      type: object
      properties:
        code:
          type: integer
          description: Response code (0 for success)
          example: 0
        message:
          type: string
          description: Response message
          example: success
        success:
          type: boolean
          description: Whether the request was successful
          example: true
        data:
          $ref: '#/components/schemas/HierarchicalTeamDTO'

    HierarchicalTeamDTO:
      type: object
      properties:
        topologyId:
          type: integer
          format: int64
          description: Topology ID
          example: 1
        topologyName:
          type: string
          description: Topology name
          example: Production Environment
        globalSupervisor:
          $ref: '#/components/schemas/AgentDTO'
          nullable: true
          description: Global supervisor agent (null if not bound)
        teams:
          type: array
          description: List of teams (one per member node)
          items:
            $ref: '#/components/schemas/TeamDTO'

    TeamDTO:
      type: object
      properties:
        nodeId:
          type: integer
          format: int64
          description: Node ID
          example: 10
        nodeName:
          type: string
          description: Node name
          example: Web Server
        supervisor:
          $ref: '#/components/schemas/AgentDTO'
          nullable: true
          description: Team supervisor agent (null if not bound)
        workers:
          type: array
          description: List of team worker agents
          items:
            $ref: '#/components/schemas/AgentDTO'

    AgentDTO:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Agent ID
          example: 1
        name:
          type: string
          description: Agent name
          example: Global Coordinator
        role:
          type: string
          description: Agent role (specialty domain)
          enum: [GLOBAL_SUPERVISOR, TEAM_SUPERVISOR, WORKER, SCOUTER]
          example: GLOBAL_SUPERVISOR
        hierarchyLevel:
          type: string
          description: Agent hierarchy level
          enum: [GLOBAL_SUPERVISOR, TEAM_SUPERVISOR, TEAM_WORKER]
          example: GLOBAL_SUPERVISOR
        specialty:
          type: string
          description: Agent specialty description
          example: System-wide coordination and escalation
        model:
          type: string
          description: AI model identifier
          example: claude-3-opus

    ErrorResponse:
      type: object
      properties:
        code:
          type: integer
          description: Error code
          example: 404
        message:
          type: string
          description: Error message
          example: Topology not found
        success:
          type: boolean
          description: Always false for errors
          example: false
        data:
          type: object
          nullable: true
          description: Always null for errors
